process {

    publishDir = { "${params.outdir}/${task.process.tokenize(':')[-1].tokenize('_')[0].toLowerCase()}" }

    withName:'test_metaphlan_single_end:METAPHLAN_METAPHLAN' {
        ext.args = '--index mpa_vJan21_TOY_CHOCOPhlAnSGB_202103 --bt2_ps very-sensitive-local --min_alignment_len 20'
    }

    withName:'test_metaphlan_paired_end:METAPHLAN_METAPHLAN' {
        ext.args = '--index mpa_vJan21_TOY_CHOCOPhlAnSGB_202103 --bt2_ps very-sensitive-local --min_alignment_len 20'
    }

    withName:'test_metaphlan_fasta:METAPHLAN_METAPHLAN' {
        ext.args = '--index mpa_vJan21_TOY_CHOCOPhlAnSGB_202103 --bt2_ps very-sensitive-local --min_alignment_len 20'
    }

    withName:'test_metaphlan_sam:METAPHLAN_METAPHLAN' {
        ext.args = '--index mpa_vJan21_TOY_CHOCOPhlAnSGB_202103 --bt2_ps very-sensitive-local --min_alignment_len 20 --nreads 200 '
    }

    withName:SAMTOOLS_VIEW {
        ext.args = '-h --output-fmt sam'
    }
}


