nextflow_process {

    name "Test Process GLIMPSE_CONCORDANCE"
    script "../main.nf"
    process "GLIMPSE_CONCORDANCE"

    config "./nextflow.config"

    tag "modules"
    tag "modules_nfcore"
    tag "glimpse"
    tag "glimpse/concordance"
    tag "glimpse/phase"
    tag "bcftools/index"

    test("test_glimpse_concordance") {
        when {
            process {
                """
                input[0] = [
                    [ id: "NA12878" ],
                    file(params.modules_testdata_base_path + "genomics/homo_sapiens/illumina/vcf/NA12878.chr21_22.1X.glimpse2.vcf.gz",checkIfExists:true),
                    file(params.modules_testdata_base_path + "genomics/homo_sapiens/illumina/vcf/NA12878.chr21_22.1X.glimpse2.vcf.gz.csi",checkIfExists:true),
                    file(params.modules_testdata_base_path + "genomics/homo_sapiens/popgen/1000GP.chr21.sites.vcf.gz",checkIfExists:true),
                    file(params.modules_testdata_base_path + "genomics/homo_sapiens/popgen/1000GP.chr21.sites.vcf.gz.csi",checkIfExists:true),
                    file(params.modules_testdata_base_path + "genomics/homo_sapiens/illumina/vcf/NA12878_GIAB.chr21_22.vcf.gz",checkIfExists:true),
                    file(params.modules_testdata_base_path + "genomics/homo_sapiens/illumina/vcf/NA12878_GIAB.chr21_22.vcf.gz.csi",checkIfExists:true),
                    "chr21"
                ]
                input[1] = 0.7
                input[2] = 3
                input[3] = []
                """
            }
        }

        then {
            assert process.success
            assert snapshot(sanitizeOutput(process.out)).match()
        }

    }

    test("test_glimpse_concordance -- stub") {
        options "-stub"
        when {
            process {
                """
                input[0] = [
                    [ id: "NA12878" ],
                    file(params.modules_testdata_base_path + "genomics/homo_sapiens/illumina/vcf/NA12878.chr21_22.1X.glimpse2.vcf.gz",checkIfExists:true),
                    file(params.modules_testdata_base_path + "genomics/homo_sapiens/illumina/vcf/NA12878.chr21_22.1X.glimpse2.vcf.gz.csi",checkIfExists:true),
                    file(params.modules_testdata_base_path + "genomics/homo_sapiens/popgen/1000GP.chr21.sites.vcf.gz",checkIfExists:true),
                    file(params.modules_testdata_base_path + "genomics/homo_sapiens/popgen/1000GP.chr21.sites.vcf.gz.csi",checkIfExists:true),
                    file(params.modules_testdata_base_path + "genomics/homo_sapiens/illumina/vcf/NA12878_GIAB.chr21_22.vcf.gz",checkIfExists:true),
                    file(params.modules_testdata_base_path + "genomics/homo_sapiens/illumina/vcf/NA12878_GIAB.chr21_22.vcf.gz.csi",checkIfExists:true),
                    "chr21"
                ]
                input[1] = 0.7
                input[2] = 3
                input[3] = []
                """
            }
        }

        then {
            assert process.success
            assert snapshot(sanitizeOutput(process.out)).match()
        }

    }
}
