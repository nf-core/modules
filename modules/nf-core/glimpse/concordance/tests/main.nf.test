nextflow_process {

    name "Test Process GLIMPSE_CONCORDANCE"
    script "../main.nf"
    process "GLIMPSE_CONCORDANCE"

    tag "modules"
    tag "modules_nfcore"
    tag "glimpse"
    tag "glimpse/concordance"
    tag "glimpse/phase"
    tag "bcftools/index"

    test("test_glimpse_concordance") {
        when {
            process {
                """
                input[0] = channel.of([
                    file(params.modules_testdata_base_path + "genomics/homo_sapiens/illumina/vcf/NA12878.chr21_22.1X.glimpse2.vcf.gz",checkIfExists:true),
                    file(params.modules_testdata_base_path + "genomics/homo_sapiens/illumina/vcf/NA12878.chr21_22.1X.glimpse2.vcf.gz.csi",checkIfExists:true),
                    file(params.modules_testdata_base_path + "genomics/homo_sapiens/popgen/1000GP.chr21.sites.vcf.gz",checkIfExists:true),
                    file(params.modules_testdata_base_path + "genomics/homo_sapiens/popgen/1000GP.chr21.sites.vcf.gz.csi",checkIfExists:true),
                    file(params.modules_testdata_base_path + "genomics/homo_sapiens/illumina/vcf/NA12878_GIAB.chr21_22.vcf.gz",checkIfExists:true),
                    file(params.modules_testdata_base_path + "genomics/homo_sapiens/illumina/vcf/NA12878_GIAB.chr21_22.vcf.gz.csi",checkIfExists:true),
                    "chr21"
                ])
                input[1] = []
                input[2] = []
                input[3] = []
                """
            }
        }

        then {
            assertAll(
                { assert process.success },
                { assert snapshot(
                    process.out.errors_cal,
                    process.out.errors_spl,
                    process.out.rsquare_spl,
                    process.out.versions
                ).match() }
            )
        }

    }
}
