// nf-core modules test t1k/run
nextflow_process {

    name "Test Process T1K_RUN"
    script "../main.nf"
    process "T1K_RUN"

    tag "modules"
    tag "modules_nfcore"
    tag "t1k"
    tag "t1k/run"

    test("homo_sapiens - paired_end  - 10x ") {

        when {
            process {
                """
                input[0] = [
                    [ id:'test', single_end:false ],
                    [file(params.modules_testdata_base_path + 'genomics/homo_sapiens/10xgenomics/cellranger/10k_pbmc_cmo/fastqs/cmo/subsampled_SC3_v3_NextGem_DI_CellPlex_Human_PBMC_10K_1_multiplexing_capture_S1_L001_R1_001.fastq.gz', checkIfExists: true),
                    file(params.modules_testdata_base_path + 'genomics/homo_sapiens/10xgenomics/cellranger/10k_pbmc_cmo/fastqs/cmo/subsampled_SC3_v3_NextGem_DI_CellPlex_Human_PBMC_10K_1_multiplexing_capture_S1_L001_R2_001.fastq.gz', checkIfExists: true)
                    ]
                ]
                input[1]=[
                    [id:'genome'],
                    file(params.modules_testdata_base_path + 'genomics/homo_sapiens/genome/chr21/sequence/genome.fasta' ,checkIfExists: true)                
                ]
                input[2]=[
                    [id: 'genome'],
                    []

                ]
                input[3]=[
                    [id: 'test'],
                    []
                ]
                input[4]=[
                    [id: 'test'],
                    []
                ]
                """
            }
        }

        then {
            assert process.success
            // TODO: Add assetions for fa,fq,tsv and vcf files
            assertAll(
                { assert snapshot(
                    process.out.allele_tsv,
                    process.out.allele_vcf.get(0).get(1).vcf,
                    process.out.genotype_tsv
                    ).match() }
            )
        }

    }

    test("homo_sapiens - paired_end - 10x - stub") {

        options "-stub"

        when {
            process {
                """
                input[0] = [
                    [ id:'test', single_end:false ],
                    [file(params.modules_testdata_base_path + 'genomics/homo_sapiens/10xgenomics/cellranger/10k_pbmc_cmo/fastqs/cmo/subsampled_SC3_v3_NextGem_DI_CellPlex_Human_PBMC_10K_1_multiplexing_capture_S1_L001_R1_001.fastq.gz', checkIfExists: true),
                    file(params.modules_testdata_base_path + 'genomics/homo_sapiens/10xgenomics/cellranger/10k_pbmc_cmo/fastqs/cmo/subsampled_SC3_v3_NextGem_DI_CellPlex_Human_PBMC_10K_1_multiplexing_capture_S1_L001_R2_001.fastq.gz', checkIfExists: true)
                    ]
                ]
                input[1]=[
                    [id:'genome'],
                    file(params.modules_testdata_base_path + 'genomics/homo_sapiens/genome/chr21/sequence/genome.fasta' ,checkIfExists: true)                
                ]
                input[2]=[
                    [id: 'genome'],
                    []
                ]
                input[3]=[
                    [id: 'test'],
                    []
                ]
                input[4]=[
                    [id: 'test'],
                    []
                ]
                """
            }
        }

        then {
            assert process.success
            assertAll(
                { assert snapshot(process.out).match() }
            )
        }

    }

}
