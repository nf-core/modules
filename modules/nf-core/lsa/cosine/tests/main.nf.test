nextflow_process {

    name "Test Process LSA_COSINE"
    script "../main.nf"
    process "LSA_COSINE"

    tag "modules"
    tag "modules_nfcore"
    tag "lsa"
    tag "lsa/cosine"

    // Test 1: Real run
    test("Should run successfully with a simple CSV") {

        when {
            process {
                """
                // Create dummy CSV
                def test_csv = file("test_data.csv")
                test_csv.text = '''gene_id,sample_A,sample_B,sample_C
                GENE_1,10.0,10.5,0.0
                GENE_2,50.0,50.5,2.0
                GENE_3,0.0,0.0,100.0
                GENE_4,100.0,99.5,10.0'''
                
                input[0] = [ [id:'test_sample'], test_csv ]
                """
            }
        }

        then {
            assert process.success
            // Snapshot versions and the matrix content (heatmap is binary, so we check name only)
            assert snapshot(
                process.out.matrix,
                process.out.versions,
                file(process.out.heatmap[0][1]).name
            ).match()
        }

    }

    // Test 2: Stub run (fast check)
    test("Stub run") {
        options "-stub"
        
        when {
            process {
                """
                def test_csv = file("test_data.csv")
                test_csv.text = '''gene_id,sample_A,sample_B''' // content doesn't matter for stub
                input[0] = [ [id:'test_sample'], test_csv ]
                """
            }
        }

        then {
            assert process.success
            assert snapshot(process.out).match()
        }
    }

}
