nextflow_process {

    name "Test Process MUSCLE5_SUPER5"
        script "../main.nf"
        process "MUSCLE5_SUPER5"
        config "./nextflow.config"

        tag "modules"
        tag "modules_nfcore"
        tag "muscle5"
        tag "muscle5/super5"

        test("fasta - align_sequence") {
            when {
                process {
                    """
                        input[0] = [ [ id:'test' ],
                        file("https://raw.githubusercontent.com/nf-core/test-datasets/multiplesequencealign/testdata/setoxin-ref.fa", checkIfExists: true)
                        ]
                        """
                }
            }

            then {
                assertAll(
                        { assert process.success },
                        // although MUSCLE5 is deterministic, for some reason nf-test still computes the checksum before unzipping, which is not deterministic
                        //{ assert snapshot(process.out.alignment).match("alignment")},
                        // check for correct entries instead
                        { assert path(process.out.alignment[0][1]).getTextGzip().contains(">1bds") },
                        { assert path(process.out.alignment[0][1]).getTextGzip().contains(">1ahl") },
                        { assert path(process.out.alignment[0][1]).getTextGzip().contains(">1atx") },
                        { assert path(process.out.alignment[0][1]).getTextGzip().contains(">1sh1") },
                        { assert path(process.out.alignment[0][1]).getTextGzip().contains(">1apf") }
                        )
            }
        }
}
