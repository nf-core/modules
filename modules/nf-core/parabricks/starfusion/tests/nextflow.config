process {
    withName: 'PARABRICKS_STARFUSION' {
        ext.args = params.module_args
    }

    // Parabricks rnafq2bam requires more memory
    withName: 'PARABRICKS_RNAFQ2BAM' {
        ext.args = params.rnafq2bam_args
        accelerator.request = 1
        memory = 30.GB
    }

    // Parabricks requires STAR version 2.7.2a
    withName: 'STAR_GENOMEGENERATE' {
        conda = 'bioconda::htslib=1.21 bioconda::samtools=1.21 bioconda::star=2.7.2a conda-forge::gawk=5.1.0'
        container = {
            (workflow.containerEngine == 'singularity' && !task.ext.singularity_pull_docker_container)
            ? 'https://community-cr-prod.seqera.io/docker/registry/v2/blobs/sha256/90/90e5dfb6f785d74101a62b11668bb53a7020647ddda2df959c7c18023ee5c591/data'
            : 'community.wave.seqera.io/library/htslib_samtools_star_gawk:4de2f983041d42e6'
        }
    }

    // Parabricks requires STAR-Fusion version 1.7.0
    withName: 'STARFUSION_BUILD' {
        conda = 'bioconda::dfam=3.7 bioconda::hmmer=3.4 bioconda::minimap2=2.30 bioconda::star-fusion=1.7.0'
        container = {
            (workflow.containerEngine == 'singularity' && !task.ext.singularity_pull_docker_container)
            ? 'https://community-cr-prod.seqera.io/docker/registry/v2/blobs/sha256/75/75d085bf2a8e40c6693b357800eef0f9568f661226d0888339bc77f7852234bb/data'
            : 'community.wave.seqera.io/library/dfam_hmmer_minimap2_star-fusion:e285bb3eb373b9a7'
        }
    }
}
