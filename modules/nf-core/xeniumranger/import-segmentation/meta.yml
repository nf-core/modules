name: xeniumranger_import_segmentation
description: |
  The xeniumranger import-segmentation module runs `xeniumranger import-segmentation`
  to recompute Xenium Onboard Analysis outputs using external segmentation results.
  It supports two execution modes mirroring the Xenium Ranger CLI: an image-based
  mode that accepts nuclei and/or cell masks (TIFF/NPY) or GeoJSON polygons together
  with optional coordinate transforms and unit definitions, and a transcript-based
  mode that ingests Baysor-style transcript assignment CSV files plus visualization
  polygons. Use the image-based inputs when providing label masks or polygons, or
  switch to the transcript-based inputs when supplying transcript-level assignments
  so the appropriate command-line arguments are passed to Xenium Ranger.
keywords:
  - spatial
  - segmentation
  - import segmentation
  - nuclear segmentation
  - cell segmentation
  - xeniumranger
  - imaging
tools:
  - xeniumranger:
      description: |
        Xenium Ranger is a set of analysis pipelines that process Xenium In Situ Gene Expression data to relabel, resegment, or import new segmentation results from community-developed tools. Xenium Ranger provides flexible off-instrument reanalysis of Xenium In Situ data. Relabel transcripts, resegment cells with the latest 10x segmentation algorithms, or import your own segmentation data to assign transcripts to cells.
      homepage: "https://www.10xgenomics.com/support/software/xenium-ranger/latest"
      documentation: "https://www.10xgenomics.com/support/software/xenium-ranger/latest/getting-started"
      tool_dev_url: "https://www.10xgenomics.com/support/software/xenium-ranger/latest/analysis"
      licence:
        - "10x Genomics EULA"
      identifier: ""

input:
  - - meta:
        type: map
        description: |
          Groovy Map containing run information
          e.g. [ id:'xenium_sample' ]
    - xenium_bundle:
        type: directory
        description: Path to the Xenium output bundle generated by the Xenium
          Onboard Analysis pipeline
    - transcript_assignment:
        type: file
        optional: true
        description: |
          Transcript assignment CSV with cell assignment, such as from Baysor v0.6, (transcript-based mode).
          Mutually exclusive with image-based inputs (`nuclei`, `cells`). Required when using
          transcript-based mode. Passed to `--transcript-assignment`.
        pattern: "*.csv"
        ontologies:
          - edam: http://edamontology.org/format_3752 # CSV
    - viz_polygons:
        type: file
        optional: true
        description: |
          Cell boundary polygons (GeoJSON) for visualization, such as from Baysor v0.6 (transcript-based mode).
          Mutually exclusive with image-based inputs (`nuclei`, `cells`). Required when using
          `transcript_assignment`. Passed to `--viz-polygons`.
        pattern: "*.{json,geojson}"
        ontologies:
          - edam: http://edamontology.org/format_3464 # JSON
    - nuclei:
        type: file
        optional: true
        description: |
          Nucleus segmentation input as label mask (TIFF/NPY), polygons (GeoJSON), or Xenium Onboard
          Analysis cells.zarr.zip (image-based mode).
          Mutually exclusive with transcript-based inputs
          (`transcript_assignment`, `viz_polygons`). Passed to `--nuclei`.
        pattern: "*.{tif,tiff,npy,json,geojson,zarr.zip}"
        ontologies:
          - edam: http://edamontology.org/format_4003 # NumPy format
          - edam: http://edamontology.org/format_3464 # JSON
    - cells:
        type: file
        optional: true
        description: |
          Cell segmentation input as label mask (TIFF/NPY), polygons (GeoJSON), or Xenium Onboard
          Analysis cells.zarr.zip (image-based mode).
          Mutually exclusive with transcript-based inputs
          (`transcript_assignment`, `viz_polygons`). Passed to `--cells`.
        pattern: "*.{tif,tiff,npy,json,geojson,zarr.zip}"
        ontologies:
          - edam: http://edamontology.org/format_4003 # NumPy format
          - edam: http://edamontology.org/format_3464 # JSON
    - coordinate_transform:
        type: file
        optional: true
        description: |
          Image alignment file containing similarity transform matrix (e.g., `_imagealignment.csv` from
          Xenium Explorer). Only used with image-based mode inputs (`nuclei`, `cells`). `units` will be automatically set to "microns". Passed to `--coordinate-transform`.
        pattern: "*.csv"
        ontologies:
          - edam: http://edamontology.org/format_3752 # CSV
    - units:
        type: string
        optional: true
        description: |
          Units for segmentation results. Must be one of two options: "microns" (physical space) or
          "pixels" (pixel space). Can be used with both image-based and transcript-based modes.
          Default: "pixels". Must be "microns" if `coordinate_transform` is used. For Baysor v0.6
          inputs, must be "microns". Passed to `--units`.
        enum:
          - "microns"
          - "pixels"
output:
  outs:
    - - meta:
          type: map
          description: Groovy Map containing sample information e.g. [ id:'test' ]
      - ${prefix}:
          type: directory
          description: Directory containing the output xenium bundle of Xenium
            Ranger
          pattern: "${prefix}"
  versions_xeniumranger:
    - - ${task.process}:
          type: string
          description: The process the versions were collected from
      - xeniumranger:
          type: string
          description: The tool name
      - xeniumranger -V | sed -e 's/.*xenium-//':
          type: string
          description: The command used to generate the version of the tool
topics:
  versions:
    - - ${task.process}:
          type: string
          description: The process the versions were collected from
      - xeniumranger:
          type: string
          description: The tool name
      - xeniumranger -V | sed -e 's/.*xenium-//':
          type: string
          description: The command used to generate the version of the tool
authors:
  - "@khersameesh24"
  - "@dongzehe"
maintainers:
  - "@khersameesh24"
  - "@dongzehe"
