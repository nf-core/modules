{
    $schema: "https://docs.renovatebot.com/renovate-schema.json",
    extends: [
        "github>nf-core/ops//.github/renovate/default.json5",
    ],
    prHeader: "## WARNING\n - [ ] I have made sure to update the singularity and conda images",
    packageRules: [
        {
            matchDatasources: ["conda", "pypi", "docker"],
            automerge: false,
        },
        {
            matchManagers: [
                "github-actions",
                "npm",
                "pip_requirements",
                "pip_setup",
            ],
            groupName: "Infrastructural dependencies",
            schedule: ["before 6am on Monday"],
            matchPackageNames: ["!/biocontainers/*/"],
        },
    ],
    customManagers: [
        {
            customType: "regex",
            managerFilePatterns: [
                "/(^|/)(workflow-templates|\\.(?:github|gitea|forgejo)/(?:workflows|actions))/.+\\.ya?ml$/",
                "/(^|/)action\\.ya?ml$/",
            ],
            matchStrings: [
                "# renovate: datasource=(?<datasource>[a-z-.]+?) depName=(?<depName>[^\\s]+?)(?: (?:lookupName|packageName)=(?<packageName>[^\\s]+?))?(?: versioning=(?<versioning>[^\\s]+?))?(?: extractVersion=(?<extractVersion>[^\\s]+?))?\\s+[A-Za-z0-9_]+?_VER(SION)?\\s*:\\s*[\"']?(?<currentValue>.+?)[\"']?\\s",
            ],
        },
        {
            customType: "regex",
            description: "Upgrade conda dependencies",
            fileMatch: ["(^|/)environment(.*).ya?ml$"],
            matchStrings: [
                '#\\s*renovate\\s+datasource=conda\\s+depName=(?<depName>.*?)\\s+-\\s*[\\w-]+:?:?[\\w-]+\\s*==?\\s*"?(?<currentValue>.*)"?',
                "# renovate: datasource=conda depName=(?<depName>.*?)\\s+-\\s*[\\w-]+:?:?[\\w-]+\\s*==?\\s*\"?(?<currentValue>.*)\"?",
            ],
            datasourceTemplate: "conda",
        },
        {
            customType: "regex",
            description: "Upgrade pypi dependencies inside conda environment files",
            fileMatch: ["(^|/)environment(.*).ya?ml$"],
            matchStrings: [
                "# renovate datasource=pypi\\s+-\\s*(?<depName>[\\w-]+)\\s*(\\[[\\w,\\s]+\\])?\\s*==?\\s*(?<currentValue>.*)",
                "# renovate: datasource=pypi\\s+-\\s*(?<depName>[\\w-]+)\\s*(\\[[\\w,\\s]+\\])?\\s*==?\\s*(?<currentValue>.*)",
            ],
            datasourceTemplate: "pypi",
        },
        {
            customType: "regex",
            description: "Update container and lock file URLs in meta.yml",
            fileMatch: [
                "(^|/)meta\\.yml$"
            ],
            matchStrings: [
                "# renovate: datasource=(?<datasource>[a-z-]+) depName=(?<depName>[^\\s]+) versioning=(?<versioning>[^\\s]+)\\s*\\n\\s*name:\\s*(?<currentValue>[^\\s]+)",
                "# renovate: datasource=(?<datasource>[a-z-]+) depName=(?<depName>[^\\s]+) versioning=(?<versioning>[^\\s]+)\\s*\\n\\s*name:\\s*(?<currentValue>[^\\s]+)",
                "# renovate: datasource=(?<datasource>[a-z-]+) depName=(?<depName>[^\\s]+) versioning=(?<versioning>[^\\s]+)\\s*\\n\\s*lock file:\\s*(?<currentValue>[^\\s]+)"
            ],
        },
    ],
}
